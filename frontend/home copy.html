<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous" />

  <title>Mason Formula Solver</title>
  <style>
    form {
      padding: 20px;
    }
  </style>
  <script type="text/javascript" src="math.min.js"></script>
  <script type="text/javascript" src="./graph.js"></script>
  <script type="text/javascript" src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Mason Formula Solver</a>
    </div>
  </nav>
  <div class="container">
    <!-- Inputs-->
    <div class="my-3 row align-items-center justify-content-center">

      <!-- Add node -->
      <div class="col-1">
        <button type="button" class="btn btn-primary w-100" onclick="addNode()">
          Add Node
        </button>
      </div>

      <!-- Add Edge -->
      <form class="col-4 border border-2 border-success rounded">
        <div class="input-group">
          <input type="text" class="form-control" id="edgeFrom" placeholder="edge from" />
          <input type="text" class="form-control" id="edgeTo" placeholder="edge to" />
          <input type="text" class="form-control" id="value" placeholder="edge value" />
          <button type="button" class="btn btn-primary" onclick="addEdge()">
            Add Edge
          </button>
        </div>
      </form>

      <!-- Delete Node -->
      <form class="col-3 border border-2 border-danger rounded">
        <div class="input-group">
          <input type="text" class="form-control" id="nodeToDelete" placeholder="node to delete" />
          <button type="button" class="btn btn-primary" onclick="deleteNode()">
            Delete Node
          </button>
        </div>
      </form>

      <!-- Delete Edge -->
      <form class="col-4  border border-2 border-danger rounded">
        <div class="input-group">
          <input type="text" class="form-control" id="edgeDeleteFrom" placeholder="edge from" />
          <input type="text" class="form-control" id="edgeDeleteTo" placeholder="edge to" />
          <button type="button" class="btn btn-primary" onclick="deleteEdge()">
            Delete Edge
          </button>
        </div>
      </form>



    </div>

    <!-- Canvas -->
    <div class="row">
      <div id="mynetwork" class="my-3 border border-dark rounded" style="height:400px;"></div>
    </div>

    <!-- Solve -->
    <div class="row mx-auto w-25">
      <button type="button" class="btn btn-primary" onclick="solveFlow()">
        Solve
      </button>
    </div>

    <br />
    <div class="container" style="text-align: left" id="solution">
      <div class="container" style="text-align: left" id="forwardPath"></div>
      <div class="container" style="text-align: center" id="individual"></div>
      <div class="container" style="text-align: right" id="nonTouching"></div>
    </div>
  </div>
  <script>
    let nodes = new vis.DataSet([
      { id: 0, label: '0' },
      { id: 1, label: '1' },
      { id: 2, label: '2' },
      { id: 3, label: '3' },
      { id: 4, label: '4' },
      { id: 5, label: '5' },
      { id: 6, label: '6' }
    ]);

    let nodes_counter = 7;

    // create an array with edges
    let edges = new vis.DataSet([
      { from: 0, to: 1, label: '1' },
      { from: 1, to: 2, label: '5' },
      { from: 1, to: 5, label: '10' },
      { from: 2, to: 3, label: '10' },
      { from: 3, to: 4, label: '2' },
      { from: 3, to: 2, label: '-1' },
      { from: 4, to: 6, label: '1' },
      { from: 4, to: 3, label: '-2' },
      { from: 4, to: 1, label: '-1' },
      { from: 5, to: 4, label: '2' },
      { from: 5, to: 5, label: '-1' }]);

    // create a network
    let container = document.getElementById('mynetwork');

    // provide the data in the vis format
    let data = {
      nodes: nodes,
      edges: edges
    };
    let options = {
      edges: {
        arrows: { to: true },
        physics: true
      },
      nodes: {
        physics: false
      }
    };

    // initialize your network!
    let network = new vis.Network(container, data, options);

    function addEdge() {
      let from = parseInt(document.getElementById("edgeFrom").value);
      let to = parseInt(document.getElementById("edgeTo").value);
      let value = document.getElementById("value").value;

      let existing_edges = edges.get({
        filter: e => e.from === from && e.to === to
      });

      if (existing_edges.length === 0)
        edges.add({ from: from, to: to, label: value });
      else
        alert('Edge already exists')
    }

    function addNode() {
      nodes.add({ id: nodes_counter, label: nodes_counter.toString() });
      nodes_counter++;
    }

    function deleteNode() {
      var node = parseInt(document.getElementById("nodeToDelete").value);

      nodes.remove(node);

      let edges_to_be_deleted = edges.get({
        filter: e => e.from === node || e.to === node
      });

      edges_to_be_deleted.forEach(e => edges.remove(e.id));
    }

    function deleteEdge() {
      let from = parseInt(document.getElementById("edgeDeleteFrom").value);
      let to = parseInt(document.getElementById("edgeDeleteTo").value);

      let edge = edges.get({
        filter: e => e.from === from && e.to === to
      });

      if (edge.length)
        edges.remove(edge[0].id);
      else
        alert('Edge does not exist!');
    }

    function solveFlow() {
      let graph = new Graph();

      nodes.get().forEach(node => graph.add_node(node.id));
      console.log(graph);

      edges.get().forEach(edge => graph.add_edge(edge.from, edge.to, edge.label));

      solve(graph);
    }

  </script>

</body>

</html>